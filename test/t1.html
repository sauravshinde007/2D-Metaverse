<!DOCTYPE html>
<html>
<head>
  <title>MOM Test Bot</title>
  <script src="https://unpkg.com/@daily-co/daily-js"></script>
</head>

<body>
<h3>MOM Test Bot Active</h3>

<script>
/* ================================
   CONFIG
================================ */

const MEETING_URL = "https://sarang.daily.co/meta-room101"; // CHANGE
const BACKEND = "http://localhost:4000";

/* ================================
   Join Meeting
================================ */

const call = DailyIframe.createCallObject();

call.join({ url: MEETING_URL });

console.log("Bot joined meeting");

/* ================================
   Speech Recognition
================================ */

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Use Chrome for this demo");
}

const recog = new SpeechRecognition();

recog.continuous = true;
recog.lang = "en-US";

recog.onresult = async (e) => {

  console.log("Speech event:", e);

  
  const result =
    e.results[e.results.length - 1][0].transcript;

  console.log("Captured:", result);

  await fetch(`${BACKEND}/api/transcript`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ text: result })
  });
};

function startRec() {
  recog.start();
}

recog.onend = () => {
  console.log("Restarting recognition...");
  startRec();
};

startRec();


console.log("Listening...");
</script>
</body>
</html>
